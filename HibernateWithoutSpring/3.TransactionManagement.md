# **ðŸš€ Step-by-Step Guide: Transaction Management in Hibernate (With H2 Database)**  

### **ðŸŽ¯ Why Is Transaction Management Important?**
Transaction management ensures **data consistency** and **integrity** in a database. It allows operations like **commit** and **rollback** in case of failures.  

---

# **ðŸ”¹ Step 1: Understanding Transactions in Hibernate**  
### **ðŸ”¹ Key Transaction Concepts**
ðŸ”¹ **Commit** â†’ Saves changes to the database.  
ðŸ”¹ **Rollback** â†’ Undoes changes if an error occurs.  
ðŸ”¹ **ACID Principles** â†’ Ensures atomicity, consistency, isolation, and durability.  

---

# **ðŸ”¹ Step 2: Configure Hibernate for Transactions**  
ðŸ“Œ **Modify `hibernate.cfg.xml` to Enable Transactions**
```xml
<hibernate-configuration>
    <session-factory>
        <!-- Database Configuration -->
        <property name="hibernate.connection.driver_class">org.h2.Driver</property>
        <property name="hibernate.connection.url">jdbc:h2:mem:testdb</property>
        <property name="hibernate.connection.username">sa</property>
        <property name="hibernate.connection.password"></property>
        <property name="hibernate.dialect">org.hibernate.dialect.H2Dialect</property>

        <!-- Enable Transactions -->
        <property name="hibernate.current_session_context_class">thread</property>

        <!-- Show SQL Queries -->
        <property name="hibernate.show_sql">true</property>
        <property name="hibernate.format_sql">true</property>
    </session-factory>
</hibernate-configuration>
```
âœ… **Key Updates**
- Configured an **in-memory H2 database**.
- Enabled **thread-based session management** for transactions.

---

# **ðŸ”¹ Step 3: Implement Transaction Management**
ðŸ“Œ **Modify `StudentDAO.java` to Manage Transactions**
```java
package com.example.dao;

import com.example.model.Student;
import com.example.util.HibernateUtil;
import org.hibernate.Session;
import org.hibernate.Transaction;

public class StudentDAO {

    // Save Student with Transaction Management
    public void saveStudent(Student student) {
        Transaction transaction = null;
        try (Session session = HibernateUtil.getSessionFactory().openSession()) {
            transaction = session.beginTransaction(); // Start Transaction
            session.save(student); // Insert into DB
            transaction.commit(); // Commit Transaction
        } catch (Exception e) {
            if (transaction != null) transaction.rollback(); // Rollback on Error
            e.printStackTrace();
        }
    }

    // Update Student with Transaction Management
    public void updateStudent(int id, String newEmail) {
        Transaction transaction = null;
        try (Session session = HibernateUtil.getSessionFactory().openSession()) {
            transaction = session.beginTransaction(); // Start Transaction
            Student student = session.get(Student.class, id);
            if (student != null) {
                student.setEmail(newEmail);
                session.update(student);
            }
            transaction.commit(); // Commit Transaction
        } catch (Exception e) {
            if (transaction != null) transaction.rollback(); // Rollback on Error
            e.printStackTrace();
        }
    }

    // Delete Student with Transaction Management
    public void deleteStudent(int id) {
        Transaction transaction = null;
        try (Session session = HibernateUtil.getSessionFactory().openSession()) {
            transaction = session.beginTransaction(); // Start Transaction
            Student student = session.get(Student.class, id);
            if (student != null) {
                session.delete(student);
            }
            transaction.commit(); // Commit Transaction
        } catch (Exception e) {
            if (transaction != null) transaction.rollback(); // Rollback on Error
            e.printStackTrace();
        }
    }
}
```
âœ… **Key Highlights**  
- **`transaction.beginTransaction()`** â†’ Starts a transaction.  
- **`transaction.commit()`** â†’ Saves changes permanently.  
- **`transaction.rollback()`** â†’ Reverts changes if an error occurs.  

---

# **ðŸ”¹ Step 4: Test Transactions in `Main.java`**
ðŸ“Œ **Modify `Main.java` to Simulate Transactions**
```java
package com.example;

import com.example.dao.StudentDAO;
import com.example.model.Student;

public class Main {
    public static void main(String[] args) {
        StudentDAO studentDAO = new StudentDAO();

        // Transaction: Save Student
        System.out.println("Saving student...");
        studentDAO.saveStudent(new Student("Alice", "Brown", "alice@example.com"));

        // Transaction: Update Student
        System.out.println("Updating student email...");
        studentDAO.updateStudent(1, "alice.updated@example.com");

        // Transaction: Delete Student (Simulating Error)
        System.out.println("Attempting to delete non-existing student...");
        studentDAO.deleteStudent(999); // Student ID does not exist â†’ Transaction rollback
    }
}
```

âœ… **Expected Output**
```
Saving student...
Hibernate: insert into Student (firstName, lastName, email) values (?, ?, ?)
Updating student email...
Hibernate: update Student set email=? where id=?
Attempting to delete non-existing student...
Transaction rolled back due to error: No student found with ID 999
```

---

# **ðŸ”¹ Step 5: Testing Transaction Rollback**
### **ðŸ”¹ Scenario: Simulating an Error**
To test rollback, modify `updateStudent()` to **force an error**:
```java
// Simulating error: Trying to update a non-existent field
public void updateStudent(int id, String newEmail) {
    Transaction transaction = null;
    try (Session session = HibernateUtil.getSessionFactory().openSession()) {
        transaction = session.beginTransaction();
        
        // Fetch Student
        Student student = session.get(Student.class, id);
        if (student != null) {
            student.setEmail(newEmail);
            session.update(student);
        }
        
        // Simulate an error
        if (true) throw new RuntimeException("Simulated Error");

        transaction.commit(); // Will not reach here due to error
    } catch (Exception e) {
        if (transaction != null) transaction.rollback(); // Rollback on Error
        System.out.println("Transaction Rolled Back!");
    }
}
```

âœ… **Expected Output**
```
Transaction Rolled Back!
```
The update operation **fails**, and **data remains unchanged** in the database.

---

# **âœ… Summary**
### **ðŸŽ¯ What We Implemented**
âœ” **Configured Hibernate Transactions**  
âœ” **Implemented `commit()` and `rollback()`**  
âœ” **Tested transaction rollback in error scenarios**  

### **ðŸš€ Next Steps**
Would you like to explore **Spring Integration with Hibernate**, or should we first cover **JPA basics**? ðŸ˜ƒ
