### ğŸš€ **Spring Security OAuth2 â€“ Step by Step Guide**  

OAuth2 is an industry-standard protocol for authorization. It allows **secure, delegated access** to resources without exposing user credentials.  

---

## **ğŸ“Œ Step 1: Understanding OAuth2**  

OAuth2 **simplifies authentication** by allowing users to log in with an **OAuth provider** (Google, GitHub, Facebook, etc.).  

### **ğŸ”¹ How OAuth2 Works**  
1ï¸âƒ£ **User clicks "Login with Google".**  
2ï¸âƒ£ **User is redirected to Googleâ€™s OAuth server.**  
3ï¸âƒ£ **User logs in & grants permissions.**  
4ï¸âƒ£ **Google sends an `Authorization Code` to the app.**  
5ï¸âƒ£ **The app exchanges the code for an `Access Token`.**  
6ï¸âƒ£ **The token is used to authenticate API requests.**  

---

## **ğŸ“Œ Step 2: Add Dependencies**
Add these to `pom.xml`:  

```xml
<dependencies>
    <!-- Spring Security OAuth2 -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-oauth2-client</artifactId>
    </dependency>

    <!-- Spring Boot Security -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>

    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
</dependencies>
```
âœ… **OAuth2 Client Library** for authentication  
âœ… **Spring Security** for securing endpoints  

---

## **ğŸ“Œ Step 3: Configure OAuth2 in `application.yml`**
Set up **Google OAuth2** (or GitHub, etc.).  

```yaml
spring:
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: YOUR_GOOGLE_CLIENT_ID
            client-secret: YOUR_GOOGLE_CLIENT_SECRET
            scope: profile, email
```
ğŸ”¹ **`client-id`** â†’ Found in Google Developer Console  
ğŸ”¹ **`client-secret`** â†’ Found in Google Developer Console  
ğŸ”¹ **`scope`** â†’ Defines permissions (e.g., `email`, `profile`)  

---

## **ğŸ“Œ Step 4: Create Security Configuration**
```java
package com.example.oauth.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/").permitAll()
                .anyRequest().authenticated()
            )
            .oauth2Login();  // Enables OAuth2 Login

        return http.build();
    }
}
```
âœ… **OAuth2 authentication is enabled**  
âœ… **Unauthenticated users are redirected to Google login**  

---

## **ğŸ“Œ Step 5: Create a Controller**
```java
package com.example.oauth.controller;

import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

@RestController
@RequestMapping("/user")
public class UserController {

    @GetMapping
    public Map<String, Object> getUser(@AuthenticationPrincipal OAuth2User user) {
        return user.getAttributes(); // Returns user details from Google
    }
}
```
âœ… **Returns user details (email, profile pic, etc.)**  

---

## **ğŸ“Œ Step 6: Run & Test**
1ï¸âƒ£ **Start the application**  
```bash
mvn spring-boot:run
```
2ï¸âƒ£ **Open in browser:**  
```
http://localhost:8080/user
```
ğŸ”¹ Youâ€™ll be redirected to Google for authentication.  
ğŸ”¹ After logging in, the API returns user details:  
```json
{
    "name": "John Doe",
    "email": "johndoe@gmail.com",
    "picture": "https://lh3.googleusercontent.com/photo.jpg"
}
```

---

## **ğŸ“Œ Step 7: Secure API Endpoints**
Modify `SecurityConfig` to restrict access:
```java
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/", "/public").permitAll()
            .requestMatchers("/user").authenticated()
        )
        .oauth2Login();

    return http.build();
}
```
âœ… **`/public` â†’ Open to everyone**  
âœ… **`/user` â†’ Requires authentication**  

---

### ğŸ¯ **âœ… OAuth2 Authentication is Ready!**  

Do you want to explore **OAuth2 with JWT**, **OAuth2 with Role-Based Access**, or **OAuth2 Authorization Server** next? ğŸš€
